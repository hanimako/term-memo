### Google Drive 連携機能の実装プロンプト

#### 1. リダイレクト URI の決定

Next.js (App Router)では、認証コードを受け取るための専用の**API ルート**を作成するのが一般的です。`app/api/oauth/route.ts`のようなファイルを作成します。

今回は以下の URI を使用することにします。

- **開発環境**: `http://localhost:3000/api/oauth`
- **本番環境**: `https://{your-app-domain}.vercel.app/api/oauth`

`{your-app-domain}`は、Vercel でデプロイした際のドメインに置き換えてください。

#### 2. Google Cloud Console での設定

**OAuth 同意画面の設定:**

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. プロジェクトを選択
3. 左側のメニューから「API とサービス」→「OAuth 同意画面」を選択
4. 以下の設定を行う：

   **基本情報:**

   - アプリ名: `専門用語メモ`
   - ユーザーサポートメール: あなたのメールアドレス
   - アプリのロゴ: 任意（推奨）
   - アプリのホームページ: `http://localhost:3000`
   - アプリのプライバシーポリシー: 任意
   - アプリの利用規約: 任意

   **スコープ:**

   - 「スコープを追加または削除」をクリック
   - `https://www.googleapis.com/auth/drive.file` を追加

   **テストユーザー:**

   - 「テストユーザーを追加」をクリック
   - 使用する Google アカウントのメールアドレスを追加
   - **重要**: 開発中は、使用するすべての Google アカウントをテストユーザーとして追加する必要があります

**認証情報の確認:**

1. 左側のメニューから「API とサービス」→「認証情報」を選択
2. OAuth 2.0 クライアント ID が正しく設定されていることを確認
3. 承認済みのリダイレクト URI に `http://localhost:3000/api/oauth` が含まれていることを確認

#### 3. コーディングプロンプト

上記の URI を前提として、ステップ 2 とステップ 3 のコーディングを始めます。以下の要件を満たすコードを順番に作成してください。

**ステップ 2: アプリケーションの実装**

1.  **認証開始ボタンの UI コンポーネント**: `LoginButton.tsx`というコンポーネントを作成してください。

    - ボタンのテキストは「Google Drive に接続」とします。
    - ボタンをクリックすると、Google の認証ページにリダイレクトするリンク（`https://accounts.google.com/o/oauth2/v2/auth?...`）を生成します。
    - この URL には、Google Cloud Console で取得した`client_id`、`redirect_uri`、`scope`、`response_type`を含めてください。スコープは`https://www.googleapis.com/auth/drive.file`としてください。
    - このコンポーネントは、要件定義で決めたマテリアルデザイン風の UI で、デジタルっぽい表現（ダークモード、緑色のテキスト）を適用してください。

2.  **認証コードを受け取る API ルート**: `app/api/oauth/route.ts`を作成してください。
    - この API ルートは、リダイレクト URI として機能し、URL のクエリパラメータから`code`（認証コード）を受け取ります。
    - 受け取った`code`を使って、Google からアクセストークンを取得してください。
    - 取得したアクセストークンを**サーバーサイドのセッション**（または一時的なストレージ）に安全に保存する処理を実装してください。
    - アクセストークン取得後、ユーザーをアプリのトップページ（`/`）にリダイレクトしてください。

**ステップ 3: UI/UX の調整（実装）**

3.  **エクスポート機能**:

    - `ExportButton.tsx`というコンポーネントを作成してください。
    - ボタンをクリックすると、ローカルストレージに保存されているデータを JSON 形式に変換し、Google Drive にアップロードする処理を実装してください。
    - この際、ステップ 2 で取得したアクセストークンを使用してください。
    - アップロードが完了したら、「エクスポートが完了しました！」というメッセージを表示してください。

4.  **インポート機能**:
    - `ImportButton.tsx`というコンポーネントを作成してください。
    - ボタンをクリックすると、Google Drive から最新の JSON ファイルをダウンロードし、ローカルストレージのデータを上書きする処理を実装してください。
    - ダウンロードが完了したら、「インポートが完了しました！」というメッセージを表示してください。

#### 4. トラブルシューティング

**「アクセスをブロック: 専門用語メモ は Google の審査プロセスを完了していません」エラーについて:**

このエラーは、OAuth 同意画面の設定が未完了であることを示しています。以下の手順で解決できます：

1. **テストユーザーの追加:**

   - Google Cloud Console → OAuth 同意画面 → テストユーザー
   - 使用する Google アカウントのメールアドレスを追加
   - 最大 100 人まで追加可能

2. **アプリの公開状態の確認:**

   - 開発中は「テスト」モードのままにする
   - 「本番運用」に変更する場合は、Google の審査が必要

3. **スコープの確認:**

   - `https://www.googleapis.com/auth/drive.file` が正しく追加されていることを確認

4. **リダイレクト URI の確認:**
   - 認証情報 → OAuth 2.0 クライアント ID → 承認済みのリダイレクト URI
   - `http://localhost:3000/api/oauth` が含まれていることを確認
